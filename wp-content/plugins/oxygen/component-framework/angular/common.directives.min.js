var CTCommonDirectives=angular.module("CTCommonDirectives",[]);CTCommonDirectives.factory("ctScopeService",function(){var n={};return{store:function(e,t){n[e]=t},get:function(e){return n[e]}}}),CTCommonDirectives.factory("ctOxyCache",function(){var n={};return{store:function(e,t){n[e]=t},get:function(e){return n[e]}}}),CTCommonDirectives.directive("ctiriscolorpicker",function(){return{restrict:"A",require:"ngModel",scope:{ctiriscallback:"=",gradientindex:"="},link:function(r,c,t,l){var n=!1;setTimeout(function(){c.alphaColorPicker({color:r.$parent.iframeScope.getGlobalColorValue(l.$modelValue),change:function(e){c.val().length!=e.color.toString().length&&0!==c.val().length||n||(n=setTimeout(function(){void 0!==r.$parent.globalColorToEdit.id?(r.$parent.updateGlobalColorValue(c.ctColorPicker("color")),r.$parent.globalColorChange()):l.$setViewValue(r.$parent.iframeScope.getGlobalColorValue(c.ctColorPicker("color"))),clearTimeout(n),n=!1},100)),r.ctiriscallback&&r.ctiriscallback()}});var e=t.ngModel;void 0!==r.gradientindex&&(e=e.replace("$index",r.gradientindex)),r.$parent.$watch(e,function(e){var t=r.$parent.iframeScope.getGlobalColorNiceName(e),n=c.closest(".oxygen-color-picker");if(jQuery(".oxy-global-color-label",n).remove(),t){var o;n.removeClass("oxy-not-global-color-value").children("input").prop("disabled",!0).after("<span class='oxy-global-color-label' title='"+t+"'>"+t+"<span class='oxy-global-color-label-remove'>x</span></span>");var i=r.$parent.iframeScope.getGlobalColorValue(e).replace(/ /g,"");o=i.match(/rgba\(\d+\,\d+\,\d+\,([^\)]+)\)/)?(o=100*parseFloat(i.match(/rgba\(\d+\,\d+\,\d+\,([^\)]+)\)/)[1]).toFixed(2),parseInt(o)):100;var a=c.closest(".wp-picker-container").find(".alpha-slider");a.slider("value",o),a.find(".ui-slider-handle").text(o.toString())}else n.addClass("oxy-not-global-color-value").children("input").prop("disabled",!1),r.$parent.$parent.activeGlobalColor={};if(n.addClass("oxy-not-empty-color-value"),!(e&&""!==e||l.$modelValue))return n.removeClass("oxy-not-empty-color-value"),void c.closest(".wp-picker-container").find(".wp-color-result").css("background-color","");c.ctColorPicker("color",r.$parent.iframeScope.getGlobalColorValue(e))}),r.$apply()},0)}}}),CTCommonDirectives.directive("ctdynamicdata",["$compile","ctScopeService",function($compile,ctScopeService){return{restrict:"A",replace:!0,scope:{data:"=",callback:"=",noshadow:"=",backbutton:"="},link:function(scope,element,attrs){angular.element("body").on("click",".oxy-dynamicdata-popup-background, .oxygen-data-close-dialog",function(){angular.element("#ctdynamicdata-popup").remove(),angular.element(".oxy-dynamicdata-popup-background").remove()}),scope.dynamicDataModel={},scope.showOptionsPanel={item:!1},scope.processCallback=function(e,t,n){if(n&&(scope.showOptionsPanel.item=e.name+e.data+t.data,"button"==e.type&&(void 0===scope.dynamicDataModel.settings_path?scope.dynamicDataModel.settings_path=e.data:scope.dynamicDataModel.settings_path=scope.dynamicDataModel.settings_path+"/"+e.data)),scope.callback&&(!e.properties||0==e.properties.length)){var o='[oxygen data="'+t.data+'"',i={},a=function(e){scope.dynamicDataModel.hasOwnProperty(e.data)&&void 0!==scope.dynamicDataModel[e.data].trim&&""!==scope.dynamicDataModel[e.data].trim()&&!e.helper&&scope.dynamicDataModel[e.data]!==e.nullVal&&scope.fieldIsVisible(e)&&(i[e.data]=scope.dynamicDataModel[e.data]),_.each(e.properties,function(e){a(e)})};_.each(t.properties,function(e){a(e)}),_.each(i,function(e,t){e=e.replace(/'/g,"__SINGLE_QUOTE__"),o+=" "+t+'="'+e+'"'}),t.append&&(o+=" "+t.append),void 0!==scope.dynamicDataModel.settings_path&&(o+=' settings_path="'+scope.dynamicDataModel.settings_path+'"'),o+="]",scope.callback(o),angular.element("#ctdynamicdata-popup").remove(),angular.element(".oxy-dynamicdata-popup-background").remove()}},scope.applyChange=function(property){property.change&&eval(property.change)},scope.back=function(e){scope.dynamicDataModel={},scope.showOptionsPanel.item=!1},scope.fieldIsVisible=function(e){return void 0===e.show_condition||scope.$eval(e.show_condition)},scope.isChildPanelVisible=function(e,t){if(!scope.showOptionsPanel.item)return!1;if(e.properties){for(var n=!1,o=e.properties.length-1;0<=o;o--){if(scope.showOptionsPanel.item===e.properties[o].name+e.properties[o].data+t.data)return!0;if(e.properties[o].properties&&(n=scope.isChildPanelVisible(e.properties[o],t)))return!0}return n}return!1},scope.isNavigationOnlyPanel=function(e){for(var t=!0,n=e.properties.length-1;0<=n;n--)if("button"!=e.properties[n].type&&"heading"!=e.properties[n].type&&"label"!=e.properties[n].type){t=!1;break}return t},element.on("click",function(){scope.showOptionsPanel.item=!1,scope.dynamicDataModel={},angular.element("body #ctdynamicdata-popup").remove(),angular.element("body .oxy-dynamicdata-popup-background").remove();var e='<div class="oxy-dynamicdata-popup-background"></div><div id="ctdynamicdata-popup" class="oxygen-data-dialog'+(scope.noshadow?" ct-global-conditions-add-modal":"")+'"><h1>Insert Dynamic Data</h1><div>';CtBuilderAjax.freeVersion&&(e+='<div style="border: 4px solid #7046db;-webkit-font-smoothing: antialiased;background-color: white;width: 100%;margin-bottom: 16px;padding: 24px;display: flex;line-height: 1.4;flex-direction: column;align-items: center;"><h2 style="color: black;font-weight: 400;text-align: center;line-height: 1.2;font-size: 21px;">Dynamic Data requires Oxygen Pro.</h2><a target="_blank" href="https://oxygenbuilder.com/upgrade-to-pro/?utm_source=free-version&utm_medium=in-plugin&utm_content=dynamic-data" style="padding-top: 11px;padding-bottom: 11px;padding-right: 24px;padding-left: 24px;color: white;background-color: #7046db;-webkit-font-smoothing: antialiased;-moz-osx-font-smoothing: greyscale;border-radius: 3px;font-weight: 500;text-decoration: none;box-shadow: 0px 1px 0px 0px #4016ab;margin-top: 16px;">Get Oxygen Pro</a></div>'),scope.backbutton&&(e+='<div class="oxygen-data-back-button oxygen-data-close-dialog">&lt; BACK</div>');var t=$compile(e+='<div class="oxygen-data-dialog-data-picker"ng-repeat="item in data"><h2>{{item.name}}</h2><ul><li ng-repeat="dataitem in item.children" ng-mouseup="processCallback(dataitem, dataitem, true); $event.stopPropagation();"><span>{{dataitem.name}}</span><div ng-if="dataitem.properties" ng-show="showOptionsPanel.item === dataitem.name+dataitem.data+dataitem.data || isChildPanelVisible( dataitem, dataitem )" class="oxygen-data-dialog-options" ng-mouseup="$event.stopPropagation();"><h1>{{dataitem.name}} Options</h1><div><div class="oxygen-data-back-button" ng-mouseup="back()">&lt; BACK</div><div ng-repeat="property in dataitem.properties" ng-class="{inline: property.type==\'button\'}"><div  ng-include="\'dynamicDataRecursiveDialog\'" ng-class="{inline: property.type==\'button\'}"></div></div></div><div class="oxygen-apply-button" ng-mouseup="processCallback(item, dataitem)" ng-show="!isNavigationOnlyPanel(dataitem)">INSERT</div></div></li></ul></div></div></div>')(scope);scope.$parent.$parent.oxygenUIElement.append(t),scope.$apply()})}}}]),CTCommonDirectives.directive("ctdynamiclist",["$compile","ctScopeService",function(y,e){return{restrict:"A",replace:!0,scope:{dynamicListOptions:"="},link:function(g,h,e){var r,o,i,a,c=parseInt(h.attr("ng-attr-component-id")),l=g.$parent.findComponentItem(g.$parent.componentsTree.children,c,g.$parent.getComponentItem),t=["src","icon-id"],d=function(e){e.forEach(function(n){t.forEach(function(e){void 0!==g.$parent.component.options[n.id].model[e]&&iframeScope.$watch("component.options["+n.id+"]['model']['"+e+"']",function(e,t){e!=t&&g.$parent.dynamicListAction(c,n.id)})}),n.children&&d(n.children)})},p=function(e){e.forEach(function(e){if(e.options.hasOwnProperty("original"))for(key in e.options.original){if("globalconditions"===key&&e.options.original[key].forEach(function(e){!0!==e.preview&&!1!==e.preview&&(_.findWhere(i,e)||i.push(e))}),"conditions"===key&&0<e.options.original.conditions.length&&(a[e.options.original.conditions]=e.options.original.conditions),"string"==typeof e.options.original[key])(t=e.options.original[key].match(/\[oxygen[^\]]*\]/gi))&&0<t.length&&(r.push({key:key,value:e.options.original[key],id:e.id}),t.forEach(function(e){o[e]=e}))}var t;"ct_span"==e.name&&e.options.hasOwnProperty("ct_content")&&((t=e.options.ct_content.match(/\[oxygen[^\]]*\]/gi))&&0<t.length&&(r.push({key:"ct_content",value:e.options.ct_content,id:e.id}),t.forEach(function(e){o[e]=e})));e.children&&0<e.children.length&&p(e.children)})},f=function(e,o,t,i,a){e.forEach(function(n){o[n.id]=angular.copy(g.$parent.component.options[n.id].model),o[n.id].globalconditions&&(angular.forEach(t,function(e){delete e.$$hashKey;var t=e.result;delete e.result,_.findWhere(o[n.id].globalconditions,e).result=t}),g.$parent.parentScope.getConditionsResult(function(e){o[n.id].globalConditionsResult=e},o[n.id].globalconditions)),o[n.id].conditions&&0<o[n.id].conditions.length&&void 0!==i[o[n.id].conditions]&&(o[n.id].conditionsresult=i[o[n.id].conditions]),r.filter(function(e){return e.id==n.id}).forEach(function(e){o[n.id][e.key]=e.value.replace(/\[oxygen[^\]]*\]/gi,function(e){return a[e]})}),n.children&&0<n.children.length&&f(n.children,o,t,i,a)})},v=function(e,t){var n=e.attr("ng-attr-component-id");if(n){if("span"==e.prop("tagName").toLowerCase())e.html(t[n].ct_content);else if("img"==e.prop("tagName").toLowerCase())e.attr("src",t[n].src);else if(e.hasClass("ct_video"))if(t[n].src){var o=g.$parent.getYoutubeVimeoEmbedUrl(t[n].src.trim());e.find("iframe").attr("src",o)}else e.find("iframe").attr("src","");else e.hasClass("ct_code_block")||(e.hasClass("ct_if_else_wrap")?void 0!==t[n].globalConditionsResult&&(!0===t[n].globalConditionsResult?(e.children(".ct_if_wrap").removeClass("ng-hide"),e.children(".ct_else_wrap").addClass("ng-hide")):!1===t[n].globalConditionsResult&&(e.children(".ct_if_wrap").addClass("ng-hide"),e.children(".ct_else_wrap").removeClass("ng-hide"))):e.hasClass("oxy-dynamic-list")&&console.log("nested repeater found"));t[n]&&t[n]["background-image"]&&0<t[n]["background-image"].length&&e.css("background-image","url("+t[n]["background-image"]+")"),1===t[n].conditionsresult||void 0===t[n].conditionsresult?e.removeClass("ct_hidden_by_conditional_logic"):e.addClass("ct_hidden_by_conditional_logic")}},s=function(e,n){g.$parent.tempcache.cache=e;var o=(e=JSON.parse(e)).conditions,i=e.results,a=e.logicResults,m=angular.element("<div>").css("display","none");h.append(m);var u=l.children;void 0!==n&&(child=g.$parent.findComponentItem(g.$parent.componentsTree.children,parseInt(n),g.$parent.getComponentItem),child&&(u=[child])),g.$parent.buildComponentsFromTree(u,null,!1,m),setTimeout(function(){m.find("*").each(function(){var e=angular.element(this);e[0].hasAttribute("contenteditable")&&e.attr("dyncontenteditable",!0)}),m.find("*").removeAttr("ng-model ng-if ng-hide ng-show contenteditable ng-model-options");var e,r,c,l,d,p,s,t=m.clone();m.remove(),e=i,r=o,c=a,l=t,d=u,p=n,s=angular.element("<div>").css("display","none"),e.forEach(function(e,o){var i={},t=r[o],n=c[o],a=l.clone();f(d,i,t,n,e),a.find(">").each(function(){var e=angular.element(this);v(e,i),e.find("*").each(function(){var e=angular.element(this);v(e,i)});var t=y(e)(g.$parent);if(void 0===p)s.append(t);else{var n=angular.element(angular.element('[ng-attr-component-id="'+p+'"]:not([ng-model])').get(o));0<n.length&&setTimeout(function(){n.replaceWith(t)},500)}})}),void 0===p&&h.html(s.children()),s.remove()},100)};function n(e,t){r=[],o={},i=[],a={};var n=(l=g.$parent.findComponentItem(g.$parent.componentsTree.children,e,g.$parent.getComponentItem)).children;return void 0===n?(h.html(""),!1):(void 0!==t&&(child=g.$parent.findComponentItem(g.$parent.componentsTree.children,parseInt(t),g.$parent.getComponentItem),child&&(n=[child])),0<n.length&&(p(n),void g.$parent.getDynamicDataFromQuery(e,o,i,a,s,t)))}angular.extend(g.dynamicListOptions,{action:function(e,t){e=parseInt(e),(t||c===e)&&n(e,t)}}),setTimeout(function(){l&&l.children&&(d(l.children),n(c))},0)}}}]),CTCommonDirectives.directive("dyncontenteditable",["$compile","$timeout","$interval","ctScopeService",function(e,t,n,o){return{restrict:"A",link:function(r,c,e){c.bind("dblclick",function(e){e.stopPropagation();var t=c.attr("ng-attr-component-id"),n=r.findComponentItem(r.componentsTree.children,t,r.getComponentItem);if(n){var o;if("ct_span"==n.name)angular.element("[ng-attr-component-id="+t+"]").attr("disabled","disabled"),c.removeAttr("disabled"),r.buildComponentsFromTree([n],null,!1,c),o=c.children(),c.replaceWith(o);else{angular.element("[ng-attr-component-id="+t+"]").attr("disabled","disabled"),c.removeAttr("disabled");var i=c.parent(),a=(c.index(),angular.element("<div>").css("display","none"));i.append(a),r.buildComponentsFromTree([n],null,!1,a),(o=a.children()).insertBefore(c),c.css("display","none"),c.attr("disabled","disabled"),a.remove()}setTimeout(function(){o.trigger("dblclick")},100)}})}}}]),CTCommonDirectives.directive("ctrendernestableshortcode",["$http",function(e){return{restrict:"A",link:function(o,e,t){var i=parseInt(e.attr("ng-attr-component-id")),a=function(e,t){o.$parent.component.options[i].model.wrapping_end=void 0!==t?(t=t.split("_#wrapped_content_replacer#_"),o.$parent.component.options[i].model.wrapping_start=t[0],t[1]):o.$parent.component.options[i].model.wrapping_start="",o.$parent.setOption(i,"ct_nestable_shortcode","wrapping_start"),o.$parent.setOption(i,"ct_nestable_shortcode","wrapping_end"),o.$parent.rebuildDOM(i)},n=!1;o.$watch(e.attr("ct-nestable-shortcode-model"),function(e,t){!1===n&&t!==e&&(n=setTimeout(function(){setTimeout(function(){if(o.$parent){var e=o.$parent.component.options[i].id.wrapping_shortcode;if(e){var n=[];e.replace(/\[([^\s\]]{1,})[^\]]*\]/gi,function(e,t){return n.push(e),n.push(t),""});var t={original:{full_shortcode:n[0]+"_#wrapped_content_replacer#_[/"+n[1]+"]"}};o.renderShortcode(i,"ct_shortcode",a,t)}}},0),n=!1},500))})}}}]),CTCommonDirectives.directive("ctevalconditions",function(){return{restrict:"A",link:function(t,n,e){setTimeout(function(){var e=parseInt(n.attr("ng-attr-component-id"));t.parentScope.evalGlobalConditions(e)},0)}}}),CTCommonDirectives.directive("ctrenderoxyshortcode",["$http","ctOxyCache",function(e,t){return{restrict:"A",require:"ngModel",link:function(o,i,e,t){var a=function(e,t){i.html(t)};setTimeout(function(){var e=parseInt(i.attr("ng-attr-component-id")),t=o.$parent.getOption("ct_content",e),n={original:{full_shortcode:t}};0<t.indexOf("data='content'")&&(o.$parent.currentClass="oxy-stock-content-styles",o.addClassToComponent(e,"oxy-stock-content-styles",!1),o.$parent.currentClass=!1),o.renderShortcode(e,"ct_shortcode",a,n)},0)}}}]),CTCommonDirectives.directive("contenteditable",["$timeout","$interval","ctScopeService",function(l,d,p){return{restrict:"A",require:"ngModel",link:function(i,a,r,o){function c(){o.$setViewValue(a.html())}a.unbind("paste input"),o.$render=function(){a.html(o.$viewValue||"")},a.bind("input",function(e,t){i.$apply(c),t&&void 0!==r.plaintext&&"true"===r.plaintext&&(jQuery("<span>").html(a.html()).text().trim()!==a.html().trim().replace("&nbsp;","")&&a.html(a.text()),o.$setViewValue(a.text())),""===a.html().trim()&&void 0!==r.defaulttext&&""!==r.defaulttext.trim()&&a.text(r.defaulttext);var n=l(function(){var e=i,t=r.optionname||"ct_content";i.iframeScope&&(e=i.iframeScope),e.setOption(e.component.active.id,e.component.active.name,t),d.cancel(n)},20,!1)}),a.bind("paste",function(){setTimeout(function(){a.trigger("input","paste")},0)}),void 0===r.plaintext||"true"!==r.plaintext?(a.bind("dblclick",function(e){e.stopPropagation();var t=p.get("scope").parentScope,n=r.optionname||"ct_content",o=i.getOption(n);o=(i.contentEditableData.original=o).replace(/\<span id\=\"ct-placeholder-([^\"]*)\"\>\<\/span\>/gi,function(e,t){var n=i.component.options[parseInt(t)].model.ct_content;return n.match(/\[oxygen[^\]]*\]/gi)?(i.removeComponentById(parseInt(t),"span",i.component.active.id),n):e}),i.setOptionModel(n,o,i.component.active.id,i.component.active.name),t.enableContentEdit(a),i.$apply()}),a[0].attributes["ng-attr-paragraph"]?a.bind("keypress",function(e){13==e.keyCode&&document.execCommand("formatBlock",!1,"p")}):a.bind("keypress",function(e){if(13==e.keyCode)return document.execCommand("insertHTML",!1,"<br><br>"),!1})):a.bind("keypress",function(e){if(13==e.keyCode)return a.blur(),!1}),void 0===r.ngBlur&&""===r.ngBlur||a.bind("blur",function(){var e=l(function(){i.$apply(r.ngBlur),d.cancel(e)},0,!1)})}}}]),CTCommonDirectives.directive("focusMe",["$timeout",function(o){return{scope:{trigger:"=focusMe"},link:function(t,n){t.$watch("trigger",function(e){!0===e&&o(function(){n[0].focus(),t.trigger=!1})})}}}]);